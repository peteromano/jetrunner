<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: server.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/** @module server */

'use strict';

var express     = require('express'),
    http        = require('http'),
    path        = require('path'),
    os          = require('os'),
    Logger      = require('./logger');

var app = null,
    api = {

        start: function(config, done) {
            return app = app || new Server(config, done);
        },

        shutdown: function() {
            process.exit();
        }

    };

/**
 * @param config
 * @param done
 * @constructor
 * @todo Handle errors and send an appropriate code back to the client, so the test runner doesn't think the test failed because of the actual test.
 *       This is especially an issue with 500 server errors that come from invalid jade syntax or something in the test runner template - you can
 *       get an Express template rendering error (server error), which would cause a test suite to fail...
 */
function Server(config, done) {
    var app = express(),
        port = config.port,
        client = config.client,
        runner = config.runner,
        domain = client.domain,
        template = runner.template,
        info = '(' + os.hostname()  + ', ' + domain + ':' + port + ', PID:' + process.pid + ')';

    app.configure(function(){
      app.set('port', port);
      app.set('view engine', runner.engine || 'jade');
      app.set('views', path.dirname(template));
      app.get('/', function(req, res) {
        res.render(path.basename(template).replace(path.extname(template), ''), {
          title: 'JetRunner ' + info,
          scripts: runner.scripts,
          styles: runner.styles,
          src: req.param('src') || '',
          test: req.param('test') || '',
          ui: runner.method,
          reporter: client.reporter,
          DEBUG: config.debug && 'true' || 'false'
        });
      });

      if(config.debug) {
        app.configure('development', function(){
            app.use(express.logger('dev'));
            app.use(express.errorHandler());
        });
      }

      app.use(express.bodyParser());
      app.use(express.methodOverride());
      app.use(app.router);
      app.use(express.static(path.resolve(runner.base)));
    });

    http.createServer(app).listen(port, function(){
      process
          .on('exit', function () {
            Logger.log('JetRunner server - shut down ' + info);
          })
          .on("SIGINT", function () {
            Logger.log("JeRunner - SIGINT caught - shutting down...");
            api.shutdown();
          });

      Logger.log('JetRunner server - started ' + info);

      done && done(app);
    });

    return app;
}

module.exports = function(method, config, callback) {
    return api[method] && api[method](config, callback) || this;
};</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-cli.html">cli</a></li><li><a href="module-config.html">config</a></li><li><a href="browserstack.html">drivers/browserstack</a></li><li><a href="client.html">drivers/client</a></li><li><a href="phantomjs.html">drivers/phantomjs</a></li><li><a href="saucelabs.html">drivers/saucelabs</a></li><li><a href="tunnel_client.html">drivers/tunnel_client</a></li><li><a href="module-index.html">index</a></li><li><a href="module-logger.html">logger</a></li><li><a href="module-run.html">run</a></li><li><a href="module-server.html">server</a></li><li><a href="module-util.html">util</a></li></ul><h3>Classes</h3><ul><li><a href="saucelabs-JetStream.html">JetStream</a></li><li><a href="saucelabs-SauceLabsClient.html">SauceLabsClient</a></li><li><a href="tunnel_client-TunnelClient.html">TunnelClient</a></li><li><a href="module-server-Server.html">Server</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Tue Apr 16 2013 14:03:46 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
